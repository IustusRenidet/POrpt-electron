<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>POrpt - Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/css/tom-select.bootstrap5.min.css">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light">
  <div id="alertBanner" class="alert-banner"></div>
  <div id="dashboardLoading" class="alert alert-info text-center py-2 d-none m-0 rounded-0" role="status">
    <div class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></div>
    <span>Generando dashboard, espera un momento...</span>
  </div>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
    <div class="container-fluid px-3 px-lg-5">
      <a class="navbar-brand fw-bold" href="#">POrpt</a>
      <div class="d-flex flex-wrap gap-2">
        <a id="adminLink" class="btn btn-outline-light d-flex align-items-center gap-2" href="admin.html" title="Administrar usuarios">
          <i class="bi bi-people-fill"></i>
          <span class="d-none d-md-inline">Usuarios</span>
        </a>
        <a id="reportSettingsLink" class="btn btn-outline-light d-flex align-items-center gap-2" href="report-settings.html" title="Configuración de reportes">
          <i class="bi bi-gear-fill"></i>
          <span class="d-none d-md-inline">Reportes</span>
        </a>
        <button
          id="dashboardToggleBtn"
          class="btn btn-info"
          type="button"
          data-open-label="Abrir dashboard"
          data-close-label="Ocultar dashboard"
          disabled
          aria-expanded="false"
          aria-controls="dashboardContent"
        >Dashboard</button>
        <button class="btn btn-warning" onclick="logout()">Salir</button>
      </div>
    </div>
  </nav>

  <main class="container-fluid my-4 px-3 px-lg-5">
    <div id="dashboardMain" class="dashboard-main">
      <section class="mb-4">
      <h2 class="fw-semibold">Dashboard de consumo de POs</h2>
      <div class="card shadow-sm border-0">
        <div class="card-body pb-0">
          <ul class="nav nav-pills nav-fill nav-wizard" id="dashboardWizard" role="tablist">
            <li class="nav-item" role="presentation">
              <button
                class="nav-link active"
                id="tab-overview"
                data-bs-toggle="tab"
                data-bs-target="#panel-overview"
                type="button"
                role="tab"
                aria-controls="panel-overview"
                aria-selected="true"
              >1. Principal</button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="tab-global"
                data-bs-toggle="tab"
                data-bs-target="#panel-global"
                type="button"
                role="tab"
                aria-controls="panel-global"
                aria-selected="false"
              >2. Filtros globales</button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="tab-personal"
                data-bs-toggle="tab"
                data-bs-target="#panel-personal"
                type="button"
                role="tab"
                aria-controls="panel-personal"
                aria-selected="false"
              >3. Selección personalizada</button>
            </li>
          </ul>
        </div>
        <div class="card-body">
          <div class="tab-content" id="dashboardWizardContent">
            <div class="tab-pane fade show active" id="panel-overview" role="tabpanel" aria-labelledby="tab-overview">
              <div class="card shadow-sm border-0 mb-4">
                <div class="card-body">
                  <div class="row g-3 align-items-end">
                    <div class="col-lg-4 col-md-6">
                      <label for="overviewEmpresaSelect" class="form-label">Empresa</label>
                      <select id="overviewEmpresaSelect" class="form-select">
                        <option value="">Selecciona una empresa</option>
                      </select>
                    </div>
                    <div class="col-lg-3 col-md-6">
                      <label for="overviewFilterMode" class="form-label">Filtro por fechas</label>
                      <select id="overviewFilterMode" class="form-select">
                        <option value="global">Todas las fechas</option>
                        <option value="range">Rango</option>
                        <option value="single">Un día</option>
                      </select>
                    </div>
                    <div class="col-lg-2 col-md-6 d-none" id="overviewStartDateGroup">
                      <label for="overviewStartDate" id="overviewStartDateLabel" class="form-label">Fecha inicial</label>
                      <input type="date" id="overviewStartDate" class="form-control">
                    </div>
                    <div class="col-lg-2 col-md-6 d-none" id="overviewEndDateGroup">
                      <label for="overviewEndDate" class="form-label">Fecha final</label>
                      <input type="date" id="overviewEndDate" class="form-control">
                    </div>
                    <div class="col-lg-3 col-md-6">
                      <label for="overviewSearch" class="form-label">Buscar en la tabla</label>
                      <div class="input-group input-group-sm overview-search-group">
                        <span class="input-group-text">PO</span>
                        <input
                          type="search"
                          id="overviewSearch"
                          class="form-control"
                          placeholder="Filtra por PO, remisión o factura"
                          list="overviewSearchSuggestions"
                          autocomplete="off"
                        >
                        <button class="btn btn-outline-primary" type="button" id="overviewSearchFocusBtn">Ir</button>
                      </div>
                      <datalist id="overviewSearchSuggestions"></datalist>
                      <p id="overviewSearchFeedback" class="form-text small text-muted mb-0"></p>
                    </div>
                    <div class="col-lg-3 col-md-6">
                      <span class="form-label d-block">Tipos de alerta</span>
                      <div id="overviewAlertFilters" class="d-flex flex-column gap-1">
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="overviewAlertCritical" data-alert-filter="critical">
                          <label class="form-check-label" for="overviewAlertCritical">Crítica</label>
                        </div>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="overviewAlertWarning" data-alert-filter="warning">
                          <label class="form-check-label" for="overviewAlertWarning">Alerta</label>
                        </div>
                        <!-- <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="overviewAlertOnRange" data-alert-filter="onrange-doc">
                          <label class="form-check-label" for="overviewAlertOnRange">En rango</label>
                        </div> -->
                      </div>
                    </div>
                    <div class="col-12 d-flex justify-content-end gap-2">
                      <button id="overviewRefreshBtn" class="btn btn-outline-secondary" type="button">Actualizar tabla</button>
                    </div>
                  </div>
                </div>
              </div>
              <div class="card shadow-sm border-0 mb-3">
                <div class="card-body d-flex flex-wrap justify-content-between align-items-center gap-3">
                  <div>
                    <h3 class="h6 mb-1">Resumen de la tabla</h3>
                    <p id="overviewSummaryLabel" class="mb-0 small text-muted">Selecciona una empresa para ver sus POs.</p>
                  </div>
                  <div id="overviewSummaryBadges" class="d-flex flex-wrap gap-2"></div>
                </div>
              </div>
              <div class="card shadow-sm border-0">
                <div class="card-header d-flex flex-wrap justify-content-between align-items-center gap-2">
                  <h3 class="h6 mb-0">Pedidos disponibles</h3>
                  <div class="d-flex flex-wrap gap-2">
                    <button id="overviewApplySelectionBtn" class="btn btn-outline-primary btn-sm" type="button">Aplicar al dashboard</button>
                    <button id="overviewReportBtn" class="btn btn-primary btn-sm" type="button">Generar reporte</button>
                  </div>
                </div>
                <div class="card-body p-0">
                  <div class="table-responsive">
                    <table class="table table-hover align-middle table-modern mb-0" id="overviewTable">
                      <thead class="table-light">
                        <tr>
                          <th scope="col" class="text-center" style="width: 48px;">
                            <input class="form-check-input" type="checkbox" id="overviewSelectAll">
                          </th>
                          <th scope="col">PO</th>
                          <th scope="col" class="text-center">Alerta</th>
                          <th scope="col">Fecha</th>
                          <th scope="col" class="text-end">Total</th>
                          <th scope="col" class="text-end">Remisiones</th>
                          <th scope="col" class="text-end">Facturas</th>
                          <th scope="col" class="text-end">Consumido</th>
                          <th scope="col" class="text-end">Disponible</th>
                        </tr>
                      </thead>
                      <tbody id="overviewTableBody"></tbody>
                    </table>
                  </div>
                  <div class="table-alert-legend d-flex flex-wrap align-items-center gap-3 px-3 py-2 border-top small text-muted">
                    <strong class="me-1">Simbología:</strong>
                    <span class="legend-item d-inline-flex align-items-center gap-2">
                      <span class="legend-swatch legend-critical" aria-hidden="true"></span>
                      <span>Consumo 100%</span>
                    </span>
                    <span class="legend-item d-inline-flex align-items-center gap-2">
                      <span class="legend-swatch legend-warning" aria-hidden="true"></span>
                      <span>Consumo ≥ 90%</span>
                    </span>
                  </div>
                </div>
              </div>
            </div>
            <div class="tab-pane fade" id="panel-global" role="tabpanel" aria-labelledby="tab-global">
              <div class="card border-success-subtle shadow-sm" id="universeControls">
                <div class="card-body">
                  <div class="d-flex flex-wrap justify-content-between align-items-start gap-3">
                    <div>
                      <h3 class="h5 mb-1 text-success">Reporte por fechas</h3>
                      <p class="mb-1 small text-muted">Nombre comercial: <span id="universeCompanyLabel" class="fw-semibold">SSITEL</span></p>
                      <p class="mb-0 small text-muted">Empresa seleccionada: <span id="universeSelectedEmpresa" class="fw-semibold">Selecciona una empresa</span></p>
                    </div>
                    <div class="text-end">
                      <button
                        id="generateUniverseReportBtn"
                        class="btn btn-success btn-lg px-4 d-inline-flex align-items-center gap-2 shadow-sm btn-universe-download"
                      >
                        <span class="btn-universe-icon" aria-hidden="true">⇩</span>
                        <span>Descargar universo</span>
                      </button>
                    </div>
                  </div>
                  <div class="row g-3 mt-1 align-items-end">
                    <div class="col-12 col-md-6 col-lg-4">
                      <label for="universeEmpresaSelect" class="form-label">Empresa para el reporte</label>
                      <select id="universeEmpresaSelect" class="form-select">
                        <option value="">Selecciona una empresa</option>
                      </select>
                    </div>
                    <div class="col-12 col-md-6 col-lg-4">
                      <label for="universeFilterMode" class="form-label">Filtro del universo</label>
                      <select id="universeFilterMode" class="form-select">
                        <option value="global">Global (todas las fechas)</option>
                        <option value="range">Por rango de fechas</option>
                        <option value="single">Unitario (1 día)</option>
                      </select>
                    </div>
                    <div class="col-12 col-md-6 col-lg-4 d-none" id="universeStartDateGroup">
                      <label for="universeStartDate" id="universeStartDateLabel" class="form-label">Fecha inicial</label>
                      <input type="date" id="universeStartDate" class="form-control">
                    </div>
                    <div class="col-12 col-md-6 col-lg-4 d-none" id="universeEndDateGroup">
                      <label for="universeEndDate" class="form-label">Fecha final</label>
                      <input type="date" id="universeEndDate" class="form-control">
                    </div>
                  </div>
                  <div class="row g-3 mt-1 align-items-end">
                    <div class="col-12 col-md-4">
                      <label for="universeFormat" class="form-label">Formato de salida</label>
                      <select id="universeFormat" class="form-select">
                        <option value="pdf">PDF detallado</option>
                      </select>
                    </div>
                    <div class="col-12 col-md-8">
                      <label for="universeFileName" class="form-label">Nombre del archivo (opcional)</label>
                      <input type="text" id="universeFileName" class="form-control" placeholder="">
                    </div>
                    <div class="col-12">
                      <div class="d-flex flex-wrap align-items-center gap-3 report-content-toggle">
                        <span class="small text-muted text-uppercase fw-semibold">Contenido del reporte</span>
                        <div class="form-check form-check-inline">
                          <input
                            class="form-check-input"
                            type="checkbox"
                            id="universeIncludeSummary"
                            data-customization-toggle="includeSummary"
                            checked
                          >
                          <label class="form-check-label" for="universeIncludeSummary">Resumen</label>
                        </div>
                        <div class="form-check form-check-inline">
                          <input
                            class="form-check-input"
                            type="checkbox"
                            id="universeIncludeDetail"
                            data-customization-toggle="includeDetail"
                            checked
                          >
                          <label class="form-check-label" for="universeIncludeDetail">Detalle</label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="tab-pane fade" id="panel-personal" role="tabpanel" aria-labelledby="tab-personal">
              <div class="mb-4">
                <h3 class="h5">Selecciona pedidos</h3>
              </div>
              <div class="card shadow-sm border-0 mb-4">
                <div class="card-body">
                  <div class="row g-3">
                    <div class="col-lg-6">
                      <label for="empresaSearch" class="form-label">Empresa</label>
                      <select id="empresaSearch" class="form-select" data-searchable-select data-placeholder="Selecciona una empresa">
                        <option value="">Cargando empresas...</option>
                      </select>
                    </div>
                    <div class="col-lg-6">
                      <div class="d-flex flex-wrap align-items-center gap-2 mb-1">
                        <label for="poSearch" class="form-label mb-0">PO / Pedido</label>
                        <span id="poFoundList" class="small text-muted"></span>
                      </div>
                      <select id="poSearch" class="form-select" data-searchable-select data-placeholder="Selecciona una PO base o extensión" data-empty-placeholder="Selecciona una empresa primero">
                        <option value="">Selecciona una empresa primero</option>
                      </select>
                    </div>
                    <div class="col-12">
                      <label class="form-label">POs seleccionadas para el dashboard y el reporte</label>
                      <div id="selectedPoContainer" class="selected-po-container">
                        <p class="text-muted small mb-0">No hay POs seleccionadas.</p>
                      </div>
                      <div class="d-flex flex-wrap align-items-center gap-2 mt-2">
                        <button id="clearSelectionBtn" class="btn btn-outline-secondary btn-sm" type="button">Limpiar selección</button>
                      </div>
                      <div class="card shadow-sm border-0 mt-3">
                        <div class="card-header bg-transparent border-0">
                          <button
                            class="btn btn-link card-toggle-button collapsed"
                            type="button"
                            data-bs-toggle="collapse"
                            data-bs-target="#collapseExtensions"
                            aria-expanded="false"
                            aria-controls="collapseExtensions"
                          >
                            <span class="toggle-icon" aria-hidden="true">☰</span>
                            <span class="toggle-label">Extensiones</span>
                            <span class="toggle-chevron" aria-hidden="true">▾</span>
                          </button>
                        </div>
                        <div id="collapseExtensions" class="collapse">
                          <div class="card-body">
                            <div id="extensionSelectionContainer" class="extension-selection-wrapper"></div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row g-4 mb-4">
                <div class="col-lg-6">
                  <div class="card shadow-sm h-100">
                    <div class="card-header bg-transparent border-0">
                      <button
                        class="btn btn-link card-toggle-button collapsed"
                        type="button"
                        data-bs-toggle="collapse"
                        data-bs-target="#collapseEngine"
                        aria-expanded="false"
                        aria-controls="collapseEngine"
                      >
                        <span class="toggle-icon" aria-hidden="true">☰</span>
                        <span class="toggle-label">Motor y formato</span>
                        <span class="toggle-chevron" aria-hidden="true">▾</span>
                      </button>
                    </div>
                    <div id="collapseEngine" class="collapse">
                      <div class="card-body">
                        <div class="d-flex flex-wrap align-items-center gap-3">
                          <div class="dropdown">
                            <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" id="reportEngineDropdown">
                              Modo de reporte: <span id="reportEngineLabel">-</span>
                            </button>
                            <ul class="dropdown-menu" id="reportEngineMenu"></ul>
                          </div>
                          <div>
                            <label for="reportFormatSelect" class="form-label mb-1 small text-muted">Formato principal</label>
                            <select id="reportFormatSelect" class="form-select form-select-sm">
                              <option value="pdf">PDF</option>
                            </select>
                          </div>
                          <span id="reportEngineStatus" class="badge text-bg-secondary d-none"></span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-lg-6">
                  <div class="card shadow-sm h-100">
                    <div class="card-header bg-transparent border-0">
                      <button
                        class="btn btn-link card-toggle-button collapsed"
                        type="button"
                        data-bs-toggle="collapse"
                        data-bs-target="#collapseFileName"
                        aria-expanded="false"
                        aria-controls="collapseFileName"
                      >
                        <span class="toggle-icon" aria-hidden="true">☰</span>
                        <span class="toggle-label">Nombre del archivo</span>
                        <span class="toggle-chevron" aria-hidden="true">▾</span>
                      </button>
                    </div>
                    <div id="collapseFileName" class="collapse">
                      <div class="card-body">
                        <input type="text" id="reportFileNameInput" class="form-control" placeholder="opcional">
                      </div>
                    </div>
                  </div>
                </div>
                <!-- <div class="col-12">
                  <div class="card shadow-sm">
                    <div class="card-header bg-transparent border-0">
                      <button
                        class="btn btn-link card-toggle-button collapsed"
                        type="button"
                        data-bs-toggle="collapse"
                        data-bs-target="#collapseContentCustomization"
                        aria-expanded="false"
                        aria-controls="collapseContentCustomization"
                      >
                        <span class="toggle-icon" aria-hidden="true">☰</span>
                        <span class="toggle-label">Personalización del contenido</span>
                        <span class="toggle-chevron" aria-hidden="true">▾</span>
                      </button>
                    </div>
                    <div id="collapseContentCustomization" class="collapse">
                      <div class="card-body">
                        <div class="row g-4">
                          <div class="col-lg-6">
                            <h4 class="h6 text-uppercase text-muted">Secciones del reporte</h4>
                            <p class="text-muted small mb-3">Elige si deseas incluir cada bloque cuando generes el PDF.</p>
                            <div class="vstack gap-3">
                              <div>
                                <label class="form-label" for="toggleIncludeCharts">Gráficas y comparativas</label>
                                <select id="toggleIncludeCharts" class="form-select form-select-sm" data-customization-select="includeCharts">
                                  <option value="true">Incluir</option>
                                  <option value="false">Omitir</option>
                                </select>
                                <div class="form-text">Activa las visualizaciones comparativas dentro del reporte.</div>
                              </div>
                              <div>
                                <label class="form-label" for="toggleIncludeMovements">Remisiones y facturas destacadas</label>
                                <select id="toggleIncludeMovements" class="form-select form-select-sm" data-customization-select="includeMovements">
                                  <option value="true">Incluir</option>
                                  <option value="false">Omitir</option>
                                </select>
                                <div class="form-text">Controla si se listan movimientos relevantes por extensión.</div>
                              </div>
                              <div>
                                <label class="form-label" for="toggleIncludeObservations">Observaciones y alertas</label>
                                <select id="toggleIncludeObservations" class="form-select form-select-sm" data-customization-select="includeObservations">
                                  <option value="true">Mostrar</option>
                                  <option value="false">Ocultar</option>
                                </select>
                                <div class="form-text">Incluye el bloque con comentarios y recordatorios importantes.</div>
                              </div>
                              <div>
                                <label class="form-label" for="toggleIncludeUniverse">Bloque del universo seleccionado</label>
                                <select id="toggleIncludeUniverse" class="form-select form-select-sm" data-customization-select="includeUniverse">
                                  <option value="true">Agregar</option>
                                  <option value="false">Omitir</option>
                                </select>
                                <div class="form-text">Resume el filtro de universo aplicado al reporte actual.</div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-lg-6">
                          <h4 class="h6 text-uppercase text-muted">CSV personalizado</h4>
                          <p class="text-muted small mb-3">Selecciona los conjuntos de datos que quieres exportar en CSV.</p>
                          <div class="vstack gap-3">
                            <div>
                              <label class="form-label" for="toggleCsvSummary">Resumen por PO</label>
                              <select id="toggleCsvSummary" class="form-select form-select-sm" data-customization-select="includePoResumen" data-customization-group="csv">
                                <option value="true">Incluir</option>
                                <option value="false">Omitir</option>
                              </select>
                              <div class="form-text">Agrega una fila resumen por cada PO incluida.</div>
                            </div>
                            <div>
                              <label class="form-label" for="toggleCsvRem">Remisiones detalladas</label>
                              <select id="toggleCsvRem" class="form-select form-select-sm" data-customization-select="includeRemisiones" data-customization-group="csv">
                                <option value="true">Incluir</option>
                                <option value="false">Omitir</option>
                              </select>
                              <div class="form-text">Incluye las remisiones registradas para cada extensión.</div>
                            </div>
                            <div>
                              <label class="form-label" for="toggleCsvFac">Facturas detalladas</label>
                              <select id="toggleCsvFac" class="form-select form-select-sm" data-customization-select="includeFacturas" data-customization-group="csv">
                                <option value="true">Incluir</option>
                                <option value="false">Omitir</option>
                              </select>
                              <div class="form-text">Adjunta la lista de facturas asociadas.</div>
                            </div>
                            <div>
                              <label class="form-label" for="toggleCsvTotals">Totales consolidados</label>
                              <select id="toggleCsvTotals" class="form-select form-select-sm" data-customization-select="includeTotales" data-customization-group="csv">
                                <option value="true">Incluir</option>
                                <option value="false">Omitir</option>
                              </select>
                              <div class="form-text">Genera columnas con montos autorizados, consumidos y remanentes.</div>
                            </div>
                            <div>
                              <label class="form-label" for="toggleCsvUniverse">Información del universo</label>
                              <select id="toggleCsvUniverse" class="form-select form-select-sm" data-customization-select="includeUniverseInfo" data-customization-group="csv">
                                <option value="true">Agregar</option>
                                <option value="false">Omitir</option>
                              </select>
                              <div class="form-text">Incluye columnas con el filtro de universo aplicado.</div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div> -->
              </div>
              <div class="card shadow-sm border-primary-subtle mb-4">
                <div class="card-header bg-transparent border-0">
                  <button
                    class="btn btn-link card-toggle-button collapsed"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#collapseReportOverview"
                    aria-expanded="false"
                    aria-controls="collapseReportOverview"
                  >
                    <span class="toggle-icon" aria-hidden="true">☰</span>
                    <span class="toggle-label">Resumen previo del reporte</span>
                    <span class="toggle-chevron" aria-hidden="true">▾</span>
                  </button>
                </div>
                <div id="collapseReportOverview" class="collapse">
                  <div class="card-body">
                    <div class="d-flex flex-wrap justify-content-between align-items-start gap-3">
                      <div class="flex-grow-1">
                        <h3 class="h5 mb-2">Resumen previo del reporte</h3>
                        <div class="d-flex flex-wrap align-items-center gap-2 mb-3">
                          <span class="badge text-bg-primary" id="overviewPoCount">0 POs base</span>
                          <span class="badge text-bg-light text-dark" id="overviewEmpresaBadge">Sin empresa</span>
                        </div>
                        <div id="reportSelectionOverview" class="selection-overview"></div>
                      </div>
                      
                    </div>
                    <hr class="my-4">
                    <div class="row g-3">
                      <div class="col-md-4">
                        <h4 class="h6 text-uppercase text-muted">Motor y formato</h4>
                        <p class="mb-1"><span class="fw-semibold">Motor:</span> <span id="overviewEngineLabel">-</span></p>
                        <p class="mb-1"><span class="fw-semibold">Formato:</span> <span id="overviewFormatLabel">-</span></p>
                        <p class="mb-0"><span class="fw-semibold">Archivo:</span> <span id="overviewFilename">Se generará automáticamente</span></p>
                      </div>
                      <!-- <div class="col-md-8">
                        <h4 class="h6 text-uppercase text-muted">Personalización activa</h4>
                        <div id="customizationSummary" class="d-flex flex-wrap gap-2"></div>
                      </div> -->
                    </div>
                  </div>
                </div>
              </div>
              <div class="d-flex flex-wrap justify-content-between align-items-center gap-3">
                <div class="d-flex flex-wrap align-items-center gap-2">
                  <!-- <button class="btn btn-outline-secondary" type="button" data-wizard-action="prev">Volver a filtros globales</button> -->
                  <div class="d-flex flex-column gap-1">
                    <button id="generateReportBtn" class="btn btn-preview-download">Previsualizar y descargar</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      </section>
    </div>
  </main>

  <aside id="dashboardContent" class="dashboard-panel d-none" aria-hidden="true">
    <div class="dashboard-panel-header d-flex align-items-start justify-content-between gap-2">
      <div>
        <h2 class="h5 mb-1">Dashboard de consumo</h2>
      </div>
      <div class="d-flex align-items-center gap-2">
        <button
          id="dashboardExpandBtn"
          type="button"
          class="btn btn-outline-secondary btn-sm"
          data-expand-label="Expandir"
          data-collapse-label="Minimizar"
          aria-expanded="false"
        >Expandir</button>
        <button id="dashboardCloseBtn" type="button" class="btn-close" aria-label="Cerrar dashboard"></button>
      </div>
    </div>
    <ul class="nav nav-pills nav-fill dashboard-panel-tabs" id="dashboardPanelTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button
          class="nav-link active"
          id="dashboard-tab-summary"
          data-bs-toggle="tab"
          data-bs-target="#dashboard-summary"
          type="button"
          role="tab"
          aria-controls="dashboard-summary"
          aria-selected="true"
        >Resumen</button>
      </li>
      <li class="nav-item" role="presentation">
        <button
          class="nav-link"
          id="dashboard-tab-charts"
          data-bs-toggle="tab"
          data-bs-target="#dashboard-charts"
          type="button"
          role="tab"
          aria-controls="dashboard-charts"
          aria-selected="false"
        >Gráficas</button>
      </li>
      <li class="nav-item" role="presentation">
        <button
          class="nav-link"
          id="dashboard-tab-detail"
          data-bs-toggle="tab"
          data-bs-target="#dashboard-detail"
          type="button"
          role="tab"
          aria-controls="dashboard-detail"
          aria-selected="false"
        >Detalle</button>
      </li>
    </ul>
    <div class="tab-content dashboard-panel-body" id="dashboardPanelContent">
      <div class="tab-pane fade show active" id="dashboard-summary" role="tabpanel" aria-labelledby="dashboard-tab-summary">
        <div id="summaryCards" class="summary-cards mb-4"></div>
        <div class="dashboard-panel-section">
          <div id="extensionsContainer" class="extensions-grid"></div>
        </div>
      </div>
      <div class="tab-pane fade" id="dashboard-charts" role="tabpanel" aria-labelledby="dashboard-tab-charts">
        <div class="d-flex flex-column flex-xl-row gap-3 align-items-xl-end mb-3">
          <form id="graphSearchForm" class="graph-search-form w-100 w-xl-auto" role="search">
            <label for="graphSearchInput" class="form-label small text-uppercase text-muted fw-semibold mb-1">Buscar gráfica por PO</label>
            <div class="input-group input-group-sm">
              <span class="input-group-text">PO</span>
              <input
                type="search"
                class="form-control"
                id="graphSearchInput"
                placeholder="Escribe la PO base o alguna extensión"
                autocomplete="off"
              >
              <button class="btn btn-outline-primary" type="submit" id="graphSearchSubmit">Buscar</button>
            </div>
            <p id="graphSearchFeedback" class="graph-search-feedback small text-muted mb-0 mt-1" aria-live="polite"></p>
          </form>
        </div>
        <div id="poChartsContainer" class="row g-3"></div>
      </div>
      <div class="tab-pane fade" id="dashboard-detail" role="tabpanel" aria-labelledby="dashboard-tab-detail">
        <div class="card shadow-sm table-section-card">
          <div class="card-header">
            <h3 id="poTableTitle" class="h6 mb-0">Detalle de POs seleccionadas</h3>
          </div>
          <div class="card-body p-0">
            <div class="table-responsive">
              <table
                id="poTable"
                class="table table-hover align-middle table-modern mb-0"
                aria-describedby="poTableTitle"
              ></table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </aside>

  <div class="modal fade" id="reportPreviewModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Confirmar descarga del reporte</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body">
          <div class="row g-3 mb-3">
            <div class="col-md-6">
              <p class="mb-1 small text-muted">Empresa</p>
              <p class="fw-semibold mb-0" id="previewEmpresa">-</p>
            </div>
            <div class="col-md-3">
              <p class="mb-1 small text-muted">Motor</p>
              <p class="fw-semibold mb-0" id="previewEngine">-</p>
            </div>
            <div class="col-md-3">
              <p class="mb-1 small text-muted">Formato</p>
              <select id="previewFormatSelect" class="form-select form-select-sm">
                <option value="pdf">PDF</option>
                <option value="xlsx">Excel</option>
                <option value="csv">CSV</option>
                <option value="json">JSON</option>
              </select>
            </div>
            <div class="col-12">
              <p class="mb-1 small text-muted">Archivo</p>
              <p class="fw-semibold mb-0" id="previewFileName">-</p>
            </div>
          </div>
          <div class="mb-3">
            <h6 class="text-uppercase text-muted small mb-2">POs incluidas</h6>
            <ul class="list-group list-group-flush rounded-4 border" id="previewPoList"></ul>
          </div>
          <div class="mb-3">
            <h6 class="text-uppercase text-muted small mb-2">Totales</h6>
            <ul class="list-group list-group-flush rounded-4 border" id="previewTotals"></ul>
          </div>
          <div class="mb-3">
            <h6 class="text-uppercase text-muted small mb-2">Contenido a incluir</h6>
            <div class="d-flex flex-wrap align-items-center gap-3 report-content-toggle">
              <div class="form-check form-check-inline">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="previewIncludeSummary"
                  data-customization-toggle="includeSummary"
                  checked
                >
                <label class="form-check-label" for="previewIncludeSummary">Resumen</label>
              </div>
              <div class="form-check form-check-inline">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="previewIncludeDetail"
                  data-customization-toggle="includeDetail"
                  checked
                >
                <label class="form-check-label" for="previewIncludeDetail">Detalle</label>
              </div>
            </div>
          </div>
          <div>
            <h6 class="text-uppercase text-muted small mb-2">Alertas relevantes</h6>
            <ul class="list-group list-group-flush rounded-4 border" id="previewAlerts"></ul>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-preview-download" id="confirmReportDownloadBtn">Descargar ahora</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="modalExt" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Detalle PO</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body"></div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
        </div>
      </div>
    </div>
  </div>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/js/tom-select.complete.min.js"></script>
  <script src="renderer.js"></script>
</body>
</html>
